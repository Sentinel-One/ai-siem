{
  "actions": [
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": null,
            "width": null
          },
          "position": {
            "x": 17.753941949151226,
            "y": -329.60579183859005
          }
        },
        "connection_id": null,
        "connection_name": null,
        "data": {
          "action_type": "scheduled_trigger",
          "ends_on": "never",
          "max_runs": null,
          "name": "Scheduled Trigger",
          "schedule_method": "daily",
          "schedule_value": [
            {
              "hour": 0,
              "minute": 0,
              "schedule_method": "daily",
              "tz": "America/Los_Angeles"
            }
          ],
          "until": null
        },
        "description": null,
        "integration_id": null,
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "core_action",
        "type": "scheduled_trigger",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 1
        }
      ],
      "export_id": 9,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 76,
            "width": 256
          },
          "position": {
            "x": 17.753941949151226,
            "y": -128.92859183859005
          }
        },
        "connection_id": null,
        "connection_name": null,
        "data": {
          "action_type": "variable",
          "name": "Configuration",
          "variables": [
            {
              "is_secret": false,
              "name": "scopeType",
              "value": "\"<<site>>\""
            },
            {
              "is_secret": false,
              "name": "scopeId",
              "value": "\"<<0000000000000000000>>\""
            },
            {
              "is_secret": false,
              "name": "extension",
              "value": "\"<<.msi>>\""
            },
            {
              "is_secret": false,
              "name": "========================================",
              "value": "===================================="
            },
            {
              "is_secret": false,
              "name": "scopeType-syntax",
              "value": "\"site\" or \"account\" or \"group\""
            },
            {
              "is_secret": false,
              "name": "scopeId-syntax",
              "value": " numval \"123123123123\""
            },
            {
              "is_secret": false,
              "name": "extension-syntax",
              "value": "\".msi\" or \".exe\""
            }
          ],
          "variables_scope": "local"
        },
        "description": "",
        "integration_id": null,
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "core_action",
        "type": "variable",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 7
        }
      ],
      "export_id": 1,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 76,
            "width": 256
          },
          "position": {
            "x": 17.753941949151226,
            "y": 47.74860816140989
          }
        },
        "connection_id": "4900eaf1-42e4-4157-8636-d75a25a6575a",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "get",
          "name": "Get Upgrade Policies",
          "parameters": [
            {
              "parameter_name": "scopeId",
              "parameter_value": "{{local_var.scopeId}}"
            },
            {
              "parameter_name": "sortBy",
              "parameter_value": "priority"
            },
            {
              "parameter_name": "osType",
              "parameter_value": "windows"
            },
            {
              "parameter_name": "limit",
              "parameter_value": "100"
            },
            {
              "parameter_name": "scopeLevel",
              "parameter_value": "{{local_var.scopeType}}"
            },
            {
              "parameter_name": "sortOrder",
              "parameter_value": "asc"
            }
          ],
          "payload": null,
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/upgrade-policy/all-policies@>",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 4
        }
      ],
      "export_id": 7,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 76,
            "width": 256
          },
          "position": {
            "x": 17.753941949151226,
            "y": 224.42580816140986
          }
        },
        "connection_id": null,
        "connection_name": null,
        "data": {
          "action_type": "variable",
          "name": "Find Policy",
          "variables": [
            {
              "is_secret": false,
              "name": "find_policy",
              "value": "{{Function.ISIN(\"[Hyperautomation] N-1 Windows Upgrade Policy\", Function.EXTRACT_VALUE_BY_KEY(get-upgrade-policies.body.data.policies, \"name\"))}}"
            }
          ],
          "variables_scope": "local"
        },
        "description": "",
        "integration_id": null,
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "core_action",
        "type": "variable",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 3
        }
      ],
      "export_id": 4,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 76,
            "width": 256
          },
          "position": {
            "x": 17.753941949151226,
            "y": 401.10300816140983
          }
        },
        "connection_id": null,
        "connection_name": null,
        "data": {
          "action_type": "condition",
          "condition": {
            "conditions": [
              {
                "conditions": [
                  {
                    "compared_value": "true",
                    "comparison_operator": "equals",
                    "input_value": "{{local_var.find_policy}}"
                  }
                ],
                "operator": "and"
              }
            ],
            "operator": "and"
          },
          "condition_type": "simple",
          "conditions": null,
          "conditions_relationship": "and",
          "name": "Does Upgrade Policy Exist"
        },
        "description": "",
        "integration_id": null,
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "core_action",
        "type": "condition",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": "false",
          "target": 5
        },
        {
          "custom_handle": "true",
          "target": 8
        }
      ],
      "export_id": 3,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 74,
            "width": 256
          },
          "position": {
            "x": -142.24605805084877,
            "y": 577.78020816141
          }
        },
        "connection_id": "4900eaf1-42e4-4157-8636-d75a25a6575a",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "get",
          "name": "Get Latest Packages",
          "parameters": [
            {
              "parameter_name": "platformType",
              "parameter_value": "windows"
            },
            {
              "parameter_name": "osArches",
              "parameter_value": "64 bit"
            },
            {
              "parameter_name": "status",
              "parameter_value": "ga"
            },
            {
              "parameter_name": "sortBy",
              "parameter_value": "version"
            },
            {
              "parameter_name": "sortOrder",
              "parameter_value": "desc"
            },
            {
              "parameter_name": "fileExtension",
              "parameter_value": "{{local_var.extension}}"
            },
            {
              "parameter_name": "limit",
              "parameter_value": "100"
            }
          ],
          "payload": null,
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/update/agent/packages@>",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 2
        }
      ],
      "export_id": 5,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 76,
            "width": 256
          },
          "position": {
            "x": 177.75394194915123,
            "y": 577.78020816141
          }
        },
        "connection_id": "4900eaf1-42e4-4157-8636-d75a25a6575a",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "get",
          "name": "Get Upgrade Policies 2",
          "parameters": [
            {
              "parameter_name": "scopeId",
              "parameter_value": "{{local_var.scopeId}}"
            },
            {
              "parameter_name": "sortBy",
              "parameter_value": "priority"
            },
            {
              "parameter_name": "osType",
              "parameter_value": "windows"
            },
            {
              "parameter_name": "limit",
              "parameter_value": "100"
            },
            {
              "parameter_name": "scopeLevel",
              "parameter_value": "{{local_var.scopeType}}"
            },
            {
              "parameter_name": "sortOrder",
              "parameter_value": "asc"
            },
            {
              "parameter_name": "name",
              "parameter_value": "[Hyperautomation] N-1 Windows Upgrade Policy"
            }
          ],
          "payload": null,
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/upgrade-policy/all-policies@>",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 6
        }
      ],
      "export_id": 8,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 74,
            "width": 256
          },
          "position": {
            "x": -142.24605805084877,
            "y": 752.4574081614101
          }
        },
        "connection_id": "4bfe2529-cccd-4479-a47b-0c7254aa808e",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "post",
          "name": "Create Upgrade Policy N minus 1",
          "parameters": [
            {
              "parameter_name": "platformType",
              "parameter_value": "windows"
            }
          ],
          "payload": "{\n  \"name\": \"[Hyperautomation] N-1 Windows Upgrade Policy\",\n  \"description\": \"This upgrade policy is automatically maintaned by hyperautomation for [N-1].\",\n  \"isScheduled\": true,\n  \"package\": {\n    \"build\": \"{{get-latest-packages.body.data[1].version}}\",\n    \"minor\": \"{{Function.LOWER(get-latest-packages.body.data[1].minorVersion)}}\",\n    \"major\": \"{{get-latest-packages.body.data[1].majorVersion}}\",\n    \"fileId\": \"0\"\n  },\n  \"maxRetries\": 5,\n  \"allEndpoints\": true,\n  \"osType\": \"windows\",\n  \"scopeLevel\": \"{{local_var.scopeType}}\",\n  \"scopeId\": \"{{local_var.scopeId}}\"\n}",
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/upgrade-policy/policy@>",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 0
        }
      ],
      "export_id": 2,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 74,
            "width": 256
          },
          "position": {
            "x": 177.75394194915123,
            "y": 754.4574081614101
          }
        },
        "connection_id": "4900eaf1-42e4-4157-8636-d75a25a6575a",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "get",
          "name": "Get Latest Packages 2",
          "parameters": [
            {
              "parameter_name": "platformType",
              "parameter_value": "windows"
            },
            {
              "parameter_name": "osArches",
              "parameter_value": "64 bit"
            },
            {
              "parameter_name": "status",
              "parameter_value": "ga"
            },
            {
              "parameter_name": "sortBy",
              "parameter_value": "version"
            },
            {
              "parameter_name": "sortOrder",
              "parameter_value": "desc"
            },
            {
              "parameter_name": "fileExtension",
              "parameter_value": "{{local_var.extension}}"
            },
            {
              "parameter_name": "limit",
              "parameter_value": "100"
            }
          ],
          "payload": null,
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/update/agent/packages@>",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [
        {
          "custom_handle": null,
          "target": 10
        }
      ],
      "export_id": 6,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 74,
            "width": 256
          },
          "position": {
            "x": -142.24605805084877,
            "y": 927.1346081614101
          }
        },
        "connection_id": "4bfe2529-cccd-4479-a47b-0c7254aa808e",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "post",
          "name": "Activate Upgrade Policy",
          "parameters": [],
          "payload": "{\n    \"action\": \"activate\"\n}",
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/upgrade-policy/policy/@>{{create-upgrade-policy-n-minus-1.body.id}}",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [],
      "export_id": 0,
      "parent_action": null
    },
    {
      "action": {
        "client_data": {
          "collapsed": false,
          "dimensions": {
            "height": 74,
            "width": 256
          },
          "position": {
            "x": 177.75394194915123,
            "y": 929.1346081614101
          }
        },
        "connection_id": "4bfe2529-cccd-4479-a47b-0c7254aa808e",
        "connection_name": "",
        "data": {
          "action_type": "http_request",
          "continue_on_fail": false,
          "headers": {
            "Content-Type": "application/json",
            "accept": "application/json"
          },
          "method": "put",
          "name": "Update Upgrade Policy N minus 1",
          "parameters": [
            {
              "parameter_name": "platformType",
              "parameter_value": "windows"
            }
          ],
          "payload": "{\n  \"name\": \"[Hyperautomation] N-1 Windows Upgrade Policy\",\n  \"description\": \"Maintained by Hyperautomation | Last sync {{Function.DATETIME_NOW()}} | Package: {{get-latest-packages-2.body.data[1].version}}{{local_var.extension}}\",\n  \"isScheduled\": true,\n  \"package\": {\n    \"build\": \"{{get-latest-packages-2.body.data[1].version}}\",\n    \"minor\": \"{{Function.LOWER(get-latest-packages-2.body.data[1].minorVersion)}}\",\n    \"major\": \"{{get-latest-packages-2.body.data[1].majorVersion}}\",\n    \"fileId\": \"0\"\n  },\n  \"maxRetries\": 5,\n  \"allEndpoints\": true,\n  \"osType\": \"windows\",\n  \"scopeLevel\": \"{{local_var.scopeType}}\",\n  \"scopeId\": \"{{local_var.scopeId}}\"\n}",
          "proxy_host": null,
          "proxy_password": null,
          "proxy_port": null,
          "proxy_user": null,
          "public_action_id": "afe978b7-6a52-4e4b-9871-c0c738971b6f",
          "redirect_follow": true,
          "retry_on_status_code": null,
          "retry_on_status_codes": [
            500
          ],
          "ssl_verification": true,
          "timeout": 30,
          "url": "{{Connection.protocol}}{{Connection.url}}<@/web/api/v2.1/upgrade-policy/policy@>/{{get-upgrade-policies-2.body.data.policies[0].id}}",
          "url_path": "/web/api/v2.1/agents",
          "url_prefix": null,
          "use_authentication_data": true,
          "use_proxy": false
        },
        "description": "Get upgrade Policies",
        "integration_id": "ef645af9-ed60-4efd-882e-bf534442ce86",
        "snippet_version_id": null,
        "snippet_workflow_id": null,
        "tag": "integration",
        "type": "http_request",
        "use_connection_name": false
      },
      "connected_to": [],
      "export_id": 10,
      "parent_action": null
    }
  ],
  "description": "",
  "name": "[MGMT] N-1 Upgrade Policy"
}